import { useState, useEffect } from 'react'
import { Button, Card, Input } from '../ui'

export default function OrdersManager() {
  const [orders, setOrders] = useState([])
  const [filter, setFilter] = useState('pending') // pending, confirmed, preparing, ready, delivered, cancelled
  const [loading, setLoading] = useState(false)

  // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† localStorage
  const fetchOrders = () => {
    setLoading(true)
    try {
      const savedOrders = localStorage.getItem('mahashi-orders-data')
      if (savedOrders) {
        const parsedOrders = JSON.parse(savedOrders)
        setOrders(parsedOrders)
      } else {
        // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
        setOrders([])
      }
    } catch (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error)
      setOrders([])
    } finally {
      setLoading(false)
    }
  }

  useEffect(() => {
    fetchOrders()
  }, [])

  // ØªÙ†Ø¸ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª  
  useEffect(() => {
    const cleanupOldOrders = () => {
      if (orders.length > 0) {
        const now = new Date()
        const HOURS_48 = 48 * 60 * 60 * 1000
        
        const cleanedOrders = orders.filter(order => {
          if (order.status === 'delivered' || order.status === 'cancelled') {
            const updatedTime = new Date(order.updated_at || order.created_at)
            const timeDiff = now - updatedTime
            return timeDiff < HOURS_48
          }
          return true
        })

        if (cleanedOrders.length < orders.length) {
          setOrders(cleanedOrders)
          localStorage.setItem('mahashi-orders-data', JSON.stringify(cleanedOrders))
        }
      }
    }

    // ØªÙ†Ø¸ÙŠÙ ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    cleanupOldOrders()

    // ØªÙ†Ø¸ÙŠÙ Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 30 Ø¯Ù‚ÙŠÙ‚Ø©
    const interval = setInterval(cleanupOldOrders, 30 * 60 * 1000)
    
    return () => clearInterval(interval)
  }, [orders])

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØ­ÙØ¸ ÙÙŠ localStorage
  const updateOrderStatus = (orderId, newStatus) => {
    const updatedOrders = orders.map(order => 
      order.id === orderId 
        ? { ...order, status: newStatus, updated_at: new Date().toISOString() }
        : order
    )
    setOrders(updatedOrders)
    
    // Ø­ÙØ¸ ÙÙŠ localStorage
    localStorage.setItem('mahashi-orders-data', JSON.stringify(updatedOrders))
    
    // Ø¥Ø´Ø¹Ø§Ø± ØµÙˆØªÙŠ
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhCSqJzOzdjjUHGGS57+OZSBETXLD3w2ojBjiS1+7NezAGJHTH7t2OPggXY7fp5qNbEAhMoe7qumgiCjGH0fTbjTcHGWq35+GaRhAOS6zzzm0jBipex+LMTSUDKGe+6OaUS2ooBjqC1fHOdC0EJV/tRWgvCD2M0/X6ijYHGWi66tpPEQdGm+HymGMmBTF+09Hsqr/3w+hPGBdgpt/u5V2+BT2J8eVajx6K38WR8MlCKhEQDUhZZ8mJgH0lAwBbRVOlAKBgYKVBTUplOVF4VFJaUWpFXzJNLUoWSGBfwwQGVwIBFSwYAA+JzTfPJVTFc3oPWAAm');
    audio.play().catch(() => {}); // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØµÙˆØªÙŠØ©
  }

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø¨Ø¹Ø¯ 48 Ø³Ø§Ø¹Ø© Ù…Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¥Ù„ØºØ§Ø¡)
  const cleanOldOrders = () => {
    const now = new Date()
    const HOURS_48 = 48 * 60 * 60 * 1000 // 48 Ø³Ø§Ø¹Ø© Ø¨Ø§Ù„Ù…ÙŠÙ„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
    
    const cleanedOrders = orders.filter(order => {
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ Ù…ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£Ùˆ Ù…Ù„ØºÙŠ
      if (order.status === 'delivered' || order.status === 'cancelled') {
        const updatedTime = new Date(order.updated_at || order.created_at)
        const timeDiff = now - updatedTime
        
        // Ø¥Ø°Ø§ Ù…Ø± Ø£ÙƒØ«Ø± Ù…Ù† 48 Ø³Ø§Ø¹Ø©ØŒ Ø§Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨
        return timeDiff < HOURS_48
      }
      
      // Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
      return true
    })

    // Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨Ø§Øª
    if (cleanedOrders.length < orders.length) {
      const deletedCount = orders.length - cleanedOrders.length
      setOrders(cleanedOrders)
      localStorage.setItem('mahashi-orders-data', JSON.stringify(cleanedOrders))
      
      // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø¯Ù…Ù†
      alert(`ğŸ—‘ï¸ ØªÙ… ØªÙ†Ø¸ÙŠÙ ${deletedCount} Ø·Ù„Ø¨ Ù‚Ø¯ÙŠÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø£ÙƒØ«Ø± Ù…Ù† 48 Ø³Ø§Ø¹Ø©)`)
      
      return deletedCount
    }
    
    return 0
  }

  // ØªÙ†Ø¸ÙŠÙ ÙŠØ¯ÙˆÙŠ ÙÙˆØ±ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
  const manualCleanOldOrders = () => {
    const deletedCount = cleanOldOrders()
    if (deletedCount === 0) {
      alert('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ø­Ø°Ù')
    }
  }

  // ÙØ­Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ø³ØªØªÙ… Ø£Ø±Ø´ÙØªÙ‡Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹ (Ø®Ù„Ø§Ù„ 6 Ø³Ø§Ø¹Ø§Øª)
  const getOrdersToBeArchived = () => {
    const now = new Date()
    const HOURS_42 = 42 * 60 * 60 * 1000 // 42 Ø³Ø§Ø¹Ø© (Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù Ø¨Ù€ 6 Ø³Ø§Ø¹Ø§Øª)
    const HOURS_48 = 48 * 60 * 60 * 1000 // 48 Ø³Ø§Ø¹Ø©
    
    return orders.filter(order => {
      if (order.status === 'delivered' || order.status === 'cancelled') {
        const updatedTime = new Date(order.updated_at || order.created_at)
        const timeDiff = now - updatedTime
        
        // Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ù…Ø± Ø¹Ù„ÙŠÙ‡Ø§ Ø£ÙƒØ«Ø± Ù…Ù† 42 Ø³Ø§Ø¹Ø© ÙˆØ£Ù‚Ù„ Ù…Ù† 48
        return timeDiff >= HOURS_42 && timeDiff < HOURS_48
      }
      return false
    })
  }

  // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  const filteredOrders = orders.filter(order => order.status === filter)

  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  const getOrderStats = () => {
    return {
      pending: orders.filter(o => o.status === 'pending').length,
      confirmed: orders.filter(o => o.status === 'confirmed').length,
      preparing: orders.filter(o => o.status === 'preparing').length,
      ready: orders.filter(o => o.status === 'ready').length,
      delivered: orders.filter(o => o.status === 'delivered').length,
      cancelled: orders.filter(o => o.status === 'cancelled').length,
    }
  }

  // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
  const formatTime = (dateString) => {
    return new Date(dateString).toLocaleString('ar-EG', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    })
  }

  // Ø£Ù„ÙˆØ§Ù† ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  const getStatusConfig = (status) => {
    switch (status) {
      case 'pending': 
        return { 
          color: 'bg-yellow-100 text-yellow-800 border-yellow-300', 
          icon: 'â³', 
          text: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
          bgColor: 'bg-yellow-50'
        }
      case 'confirmed': 
        return { 
          color: 'bg-blue-100 text-blue-800 border-blue-300', 
          icon: 'âœ…', 
          text: 'Ù…Ø¤ÙƒØ¯',
          bgColor: 'bg-blue-50'
        }
      case 'preparing': 
        return { 
          color: 'bg-orange-100 text-orange-800 border-orange-300', 
          icon: 'ğŸ³', 
          text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±',
          bgColor: 'bg-orange-50'
        }
      case 'ready': 
        return { 
          color: 'bg-green-100 text-green-800 border-green-300', 
          icon: 'ğŸ¯', 
          text: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙˆØµÙŠÙ„',
          bgColor: 'bg-green-50'
        }
      case 'delivered': 
        return { 
          color: 'bg-gray-100 text-gray-800 border-gray-300', 
          icon: 'ğŸšš', 
          text: 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
          bgColor: 'bg-gray-50'
        }
      case 'cancelled': 
        return { 
          color: 'bg-red-100 text-red-800 border-red-300', 
          icon: 'âŒ', 
          text: 'Ù…Ù„ØºÙŠ',
          bgColor: 'bg-red-50'
        }
      default: 
        return { 
          color: 'bg-gray-100 text-gray-800 border-gray-300', 
          icon: 'â“', 
          text: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
          bgColor: 'bg-gray-50'
        }
    }
  }

  const stats = getOrderStats()

  return (
    <div className="space-y-6">
      {/* Header with stats and controls */}
      <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-3xl font-bold text-gray-800">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
          
          {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */}
          <div className="flex gap-3">
            <Button 
              onClick={manualCleanOldOrders}
              variant="outline" 
              className="bg-red-100 hover:bg-red-200 text-red-700 border-red-300 font-bold px-4 py-2 rounded-lg transition-all duration-200"
            >
              ï¿½ï¸ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            </Button>
            
            <Button 
              onClick={fetchOrders}
              variant="primary" 
              className="bg-blue-600 hover:bg-blue-700 text-white font-bold px-4 py-2 rounded-lg transition-all duration-200"
            >
              ğŸ”„ ØªØ­Ø¯ÙŠØ«
            </Button>
          </div>
        </div>

        {/* Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ø³ØªØªÙ… Ø£Ø±Ø´ÙØªÙ‡Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹ */}
        {getOrdersToBeArchived().length > 0 && (
          <div className="mb-4 p-4 bg-orange-100 border border-orange-300 rounded-lg">
            <div className="flex items-center gap-2 text-orange-800">
              <span className="text-xl">âš ï¸</span>
              <span className="font-bold">
                {getOrdersToBeArchived().length} Ø·Ù„Ø¨ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø®Ù„Ø§Ù„ 6 Ø³Ø§Ø¹Ø§Øª
              </span>
            </div>
            <div className="text-sm text-orange-600 mt-1">
              Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙ… ØªÙˆØµÙŠÙ„Ù‡Ø§ Ø£Ùˆ Ø§Ù„Ù…Ù„ØºØ§Ø© Ù…Ù†Ø° Ø£ÙƒØ«Ø± Ù…Ù† 42 Ø³Ø§Ø¹Ø©
            </div>
          </div>
        )}
        
        {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
        <div className="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
          <div className="bg-yellow-100 p-3 rounded-lg text-center">
            <div className="text-2xl">â³</div>
            <div className="font-bold text-yellow-800">{stats.pending}</div>
            <div className="text-xs text-yellow-600">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
          </div>
          <div className="bg-blue-100 p-3 rounded-lg text-center">
            <div className="text-2xl">âœ…</div>
            <div className="font-bold text-blue-800">{stats.confirmed}</div>
            <div className="text-xs text-blue-600">Ù…Ø¤ÙƒØ¯</div>
          </div>
          <div className="bg-orange-100 p-3 rounded-lg text-center">
            <div className="text-2xl">ğŸ³</div>
            <div className="font-bold text-orange-800">{stats.preparing}</div>
            <div className="text-xs text-orange-600">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</div>
          </div>
          <div className="bg-green-100 p-3 rounded-lg text-center">
            <div className="text-2xl">ğŸ¯</div>
            <div className="font-bold text-green-800">{stats.ready}</div>
            <div className="text-xs text-green-600">Ø¬Ø§Ù‡Ø²</div>
          </div>
          <div className="bg-gray-100 p-3 rounded-lg text-center">
            <div className="text-2xl">ğŸšš</div>
            <div className="font-bold text-gray-800">{stats.delivered}</div>
            <div className="text-xs text-gray-600">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</div>
          </div>
          <div className="bg-red-100 p-3 rounded-lg text-center">
            <div className="text-2xl">âŒ</div>
            <div className="font-bold text-red-800">{stats.cancelled}</div>
            <div className="text-xs text-red-600">Ù…Ù„ØºÙŠ</div>
          </div>
        </div>

        {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */}
        <div className="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200">
          <div className="flex items-center justify-between text-sm text-gray-600">
            <div className="flex items-center gap-2">
              <span className="text-lg">ğŸ¤–</span>
              <span>Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ: ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙ… ØªÙˆØµÙŠÙ„Ù‡Ø§/Ø§Ù„Ù…Ù„ØºØ§Ø© Ø¨Ø¹Ø¯ 48 Ø³Ø§Ø¹Ø©</span>
            </div>
            <div className="flex items-center gap-4">
              <span>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: {orders.length}</span>
              {getOrdersToBeArchived().length > 0 && (
                <span className="text-orange-600 font-medium">
                  â±ï¸ Ø³ÙŠØªÙ… Ø£Ø±Ø´ÙØ© {getOrdersToBeArchived().length} Ù‚Ø±ÙŠØ¨Ø§Ù‹
                </span>
              )}
            </div>
          </div>
        </div>

        {/* ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„Ø§Øª */}
        <div className="flex gap-3 flex-wrap mt-4">
          {[
            { key: 'pending', icon: 'â³', text: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', count: stats.pending },
            { key: 'confirmed', icon: 'âœ…', text: 'Ù…Ø¤ÙƒØ¯', count: stats.confirmed },
            { key: 'preparing', icon: 'ğŸ³', text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', count: stats.preparing },
            { key: 'ready', icon: 'ğŸ¯', text: 'Ø¬Ø§Ù‡Ø²', count: stats.ready },
            { key: 'delivered', icon: 'ğŸšš', text: 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', count: stats.delivered },
            { key: 'cancelled', icon: 'âŒ', text: 'Ù…Ù„ØºÙŠ', count: stats.cancelled }
          ].map(status => (
            <Button
              key={status.key}
              variant={filter === status.key ? 'primary' : 'outline'}
              size="small"
              onClick={() => setFilter(status.key)}
              className="flex items-center gap-2"
            >
              <span className="text-lg">{status.icon}</span>
              <span>{status.text}</span>
              <span className="bg-white/20 px-2 py-1 rounded-full text-xs">{status.count}</span>
            </Button>
          ))}
          <Button
            variant="outline"
            size="small"
            onClick={fetchOrders}
            className="text-blue-600 hover:bg-blue-50"
          >
            ğŸ”„ ØªØ­Ø¯ÙŠØ«
          </Button>
        </div>
      </div>

      {/* Loading state */}
      {loading && (
        <Card>
          <Card.Content>
            <div className="text-center py-8">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
              <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
            </div>
          </Card.Content>
        </Card>
      )}

      {/* Orders List */}
      {!loading && (
        <div className="space-y-4">
          {filteredOrders.length === 0 ? (
            <Card className="border-2 border-dashed border-gray-300">
              <Card.Content>
                <div className="text-center py-16">
                  <div className="text-8xl mb-6">ï¿½</div>
                  <h3 className="text-3xl font-bold text-gray-600 mb-4">
                    {orders.length === 0 
                      ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†' 
                      : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙÙŠØ©'
                    }
                  </h3>
                  <p className="text-xl text-gray-500 mb-6">
                    {orders.length === 0 
                      ? 'Ø¨Ù…Ø¬Ø±Ø¯ Ø£Ù† ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø¹Ù…Ù„ Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙÙˆØ±Ø§Ù‹' 
                      : 'Ø¬Ø±Ø¨ ØªØµÙØ­ Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù†ØªØ¸Ø± Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©'
                    }
                  </p>
                  {orders.length === 0 && (
                    <div className="bg-blue-50 p-6 rounded-xl border border-blue-200 max-w-md mx-auto">
                      <div className="text-2xl mb-3">ğŸ’¡</div>
                      <p className="text-blue-700 font-medium">
                        Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø³ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù‡Ù†Ø§ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ·Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                      </p>
                    </div>
                  )}
                </div>
              </Card.Content>
            </Card>
          ) : (
            filteredOrders.map((order) => {
              const statusConfig = getStatusConfig(order.status)
              return (
                <Card key={order.id} className={`border-l-8 ${statusConfig.bgColor} hover:shadow-xl transition-all duration-300 mb-6`}>
                  <Card.Header className="bg-gradient-to-r from-white to-gray-50 p-6">
                    <div className="flex justify-between items-start">
                      <div className="flex items-center gap-4">
                        <div className="text-5xl animate-pulse">{statusConfig.icon}</div>
                        <div>
                          <h3 className="text-2xl font-black text-gray-800 mb-2">
                            ğŸ§¾ Ø·Ù„Ø¨ Ø±Ù‚Ù… #{order.orderNumber || order.id}
                          </h3>
                          <div className="flex items-center gap-3 text-lg text-gray-600">
                            <span className="bg-blue-100 px-3 py-1 rounded-full flex items-center gap-2">
                              <span>ğŸ•’</span>
                              {formatTime(order.created_at)}
                            </span>
                            {order.estimated_time && (
                              <span className="bg-orange-100 text-orange-800 px-3 py-1 rounded-full font-bold flex items-center gap-2">
                                <span>â°</span>
                                {order.estimated_time}
                              </span>
                            )}
                          </div>
                        </div>
                      </div>
                      <div className="text-center">
                        <span className={`px-6 py-3 rounded-xl text-lg font-black border-3 ${statusConfig.color} flex items-center gap-3 shadow-lg`}>
                          <span className="text-2xl">{statusConfig.icon}</span>
                          <span>{statusConfig.text}</span>
                        </span>
                        <div className="mt-2 text-2xl font-black text-green-600">
                          ğŸ’° {order.total_amount} Ø¬
                        </div>
                      </div>
                    </div>
                  </Card.Header>
                
                <Card.Content className="p-6">
                  <div className="grid lg:grid-cols-2 gap-8">
                    {/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ± */}
                    <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-l-8 border-blue-500 shadow-2xl">
                      <h4 className="font-black mb-8 text-3xl text-blue-800 flex items-center gap-4 bg-white p-4 rounded-xl shadow-lg">
                        <span className="text-4xl">ğŸ‘¤</span> 
                        <span>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
                      </h4>
                      <div className="space-y-6">
                        <div className="bg-white p-6 rounded-xl shadow-lg border-2 border-blue-200 hover:shadow-xl transition-all duration-300">
                          <div className="flex items-center gap-4 text-xl">
                            <span className="text-3xl text-blue-600 bg-blue-100 p-3 rounded-full">ğŸ“</span>
                            <div className="flex-1">
                              <div className="text-lg text-gray-600 font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                              <div className="text-3xl font-black text-gray-800">{order.customer_name}</div>
                            </div>
                          </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-lg border-2 border-green-200 hover:shadow-xl transition-all duration-300">
                          <div className="flex items-center gap-4 text-xl">
                            <span className="text-3xl text-green-600 bg-green-100 p-3 rounded-full">ğŸ“±</span>
                            <div className="flex-1">
                              <div className="text-lg text-gray-600 font-medium mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
                              <a href={`tel:${order.customer_phone}`} 
                                 className="text-3xl font-black text-green-600 hover:text-green-700 hover:underline block transition-all duration-200">
                                {order.customer_phone}
                              </a>
                            </div>
                          </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-lg border-2 border-red-200 hover:shadow-xl transition-all duration-300">
                          <div className="flex items-start gap-4 text-xl">
                            <span className="text-3xl text-red-600 bg-red-100 p-3 rounded-full">ğŸ“</span>
                            <div className="flex-1">
                              <div className="text-lg text-gray-600 font-medium mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„</div>
                              <div className="text-2xl font-bold text-gray-800 leading-relaxed">{order.customer_address}</div>
                            </div>
                          </div>
                        </div>
                        {order.notes && (
                          <div className="bg-gradient-to-r from-yellow-100 to-orange-100 p-6 rounded-xl border-l-8 border-yellow-500 shadow-lg">
                            <div className="flex items-start gap-4">
                              <span className="text-3xl text-yellow-600 bg-yellow-200 p-3 rounded-full">ğŸ’¬</span>
                              <div className="flex-1">
                                <div className="text-lg text-gray-600 font-medium mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                                <div className="text-2xl font-bold text-yellow-800 bg-yellow-50 p-4 rounded-lg border border-yellow-300 shadow-inner">{order.notes}</div>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>

                    {/* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ø¨Ø´ÙƒÙ„ ÙØ§Ø¦Ù‚ */}
                    <div className="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl border-l-8 border-green-500 shadow-2xl">
                      <h4 className="font-black mb-8 text-3xl text-green-800 flex items-center gap-4 bg-white p-4 rounded-xl shadow-lg">
                        <span className="text-4xl">ğŸ½ï¸</span> 
                        <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</span>
                      </h4>
                      <div className="space-y-6">
                        {order.items.map((item, index) => (
                          <div key={index} className="bg-white p-6 rounded-xl shadow-lg border-2 border-green-200 hover:shadow-xl transition-all duration-300 hover:scale-105">
                            <div className="flex justify-between items-center">
                              <div className="flex items-center gap-4">
                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white w-14 h-14 rounded-full flex items-center justify-center text-2xl font-black shadow-lg">
                                  {item.quantity}
                                </div>
                                <div>
                                  <div className="font-black text-2xl text-gray-800 mb-2">{item.name}</div>
                                  <div className="text-gray-500 text-lg font-medium">{item.price} Ø¬Ù†ÙŠÙ‡ Ã— {item.quantity} Ù‚Ø·Ø¹Ø©</div>
                                </div>
                              </div>
                              <div className="text-right bg-green-50 p-4 rounded-xl border-2 border-green-200">
                                <div className="font-black text-3xl text-green-600">{item.total || (item.quantity * parseInt(item.price))} Ø¬</div>
                                <div className="text-green-500 text-lg font-medium">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</div>
                              </div>
                            </div>
                          </div>
                        ))}
                        <div className="bg-gradient-to-r from-green-500 to-green-600 p-8 rounded-2xl shadow-2xl text-white border-4 border-green-300">
                          <div className="flex justify-between items-center">
                            <div className="flex items-center gap-4">
                              <span className="text-4xl bg-white bg-opacity-20 p-3 rounded-full">ğŸ’°</span>
                              <span className="text-2xl font-black">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø·Ù„Ø¨:</span>
                            </div>
                            <div className="bg-white bg-opacity-20 p-4 rounded-xl">
                              <span className="text-4xl font-black">{order.total_amount} Ø¬Ù†ÙŠÙ‡</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚Ø© */}
                  <div className="mt-8 pt-6 border-t-4 border-gray-200">
                    <h4 className="font-black mb-6 text-2xl text-gray-700 flex items-center gap-3 bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-xl">
                      <span className="text-3xl">âš¡</span> 
                      <span>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</span>
                    </h4>
                    <div className="flex gap-4 flex-wrap justify-center">
                      {order.status === 'pending' && (
                        <>
                          <Button
                            variant="primary"
                            size="large"
                            onClick={() => updateOrderStatus(order.id, 'confirmed')}
                            className="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-black px-8 py-4 rounded-xl shadow-2xl transform hover:scale-110 transition-all duration-300 text-xl"
                          >
                            <span className="text-2xl mr-3">âœ…</span>
                            ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙÙˆØ±Ø§Ù‹
                          </Button>
                          <Button
                            variant="outline"
                            size="large"
                            onClick={() => updateOrderStatus(order.id, 'cancelled')}
                            className="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-black px-8 py-4 rounded-xl shadow-2xl transform hover:scale-110 transition-all duration-300 text-xl"
                          >
                            <span className="text-2xl mr-3">âŒ</span>
                            Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
                          </Button>
                        </>
                      )}
                      
                      {order.status === 'confirmed' && (
                        <Button
                          variant="primary"
                          size="large"
                          onClick={() => updateOrderStatus(order.id, 'preparing')}
                          className="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-black px-8 py-4 rounded-xl shadow-2xl transform hover:scale-110 transition-all duration-300 text-xl"
                        >
                          <span className="text-2xl mr-3">ğŸ³</span>
                          Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¢Ù†
                        </Button>
                      )}
                      
                      {order.status === 'preparing' && (
                        <Button
                          variant="primary"
                          size="large"
                          onClick={() => updateOrderStatus(order.id, 'ready')}
                          className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-black px-8 py-4 rounded-xl shadow-2xl transform hover:scale-110 transition-all duration-300 text-xl"
                        >
                          <span className="text-2xl mr-3">ğŸ¯</span>
                          Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙˆØµÙŠÙ„
                        </Button>
                      )}
                      
                      {order.status === 'ready' && (
                        <Button
                          variant="primary"
                          size="large"
                          onClick={() => updateOrderStatus(order.id, 'delivered')}
                          className="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-black px-8 py-4 rounded-xl shadow-2xl transform hover:scale-110 transition-all duration-300 text-xl"
                        >
                          <span className="text-2xl mr-3">ğŸšš</span>
                          ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­
                        </Button>
                      )}
                      
                      {(order.status === 'delivered' || order.status === 'cancelled') && (
                        <div className="bg-gradient-to-r from-gray-200 to-gray-300 px-6 py-4 rounded-xl text-gray-700 font-black text-xl shadow-lg">
                          <span className="text-2xl mr-3">{getStatusConfig(order.status).icon}</span>
                          ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨
                        </div>
                      )}
                    </div>
                  </div>
                </Card.Content>
              </Card>
              )
            })
          )}
        </div>
      )}
    </div>
  )
}